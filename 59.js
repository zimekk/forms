"use strict";(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[59],{3059:(e,n,t)=>{t.r(n),t.d(n,{default:()=>J});var o=t(2784),r=t(5992),l=t(1148),a=t(859),s=t(1348),c=t(1366),u=t(878),i=t(8871),m=t(2779),d=t.n(m),f=t(6062),p=t.n(f),v=t(4036),E=t.n(v),b=t(6793),g=t.n(b),A=t(7892),C=t.n(A),w=t(1173),S=t.n(w),h=t(2464),x=t.n(h),k=t(5450),y={};y.styleTagTransform=x(),y.setAttributes=C(),y.insert=g().bind(null,"head"),y.domAPI=E(),y.insertStyleElement=S(),p()(k.Z,y);const F=k.Z&&k.Z.locals?k.Z.locals:void 0;function T(){return T=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},T.apply(this,arguments)}const I=(0,o.createContext)({});function B({data:e,handleChange:n,handleSubmit:t,...r}){return o.createElement(I.Provider,{value:{...e,handleChange:n}},o.createElement("form",T({tabIndex:0,onSubmit:t},r,{className:d()(F.Form)})))}function U({...e}){return o.createElement("fieldset",e)}function P({...e}){return o.createElement("legend",e)}const D=(0,o.createContext)({});function L({name:e,...n}){const{errors:t}=(0,o.useContext)(I);return o.createElement(D.Provider,{value:{name:e,errors:(0,o.useMemo)((()=>(t||[]).filter((({path:n})=>n.join(".")===e))),[t])}},o.createElement("div",n))}function G({...e}){const{name:n}=(0,o.useContext)(D);return o.createElement("div",null,o.createElement("label",T({htmlFor:n},e)))}function Z({...e}){const{name:n}=(0,o.useContext)(D),{form:t,handleChange:r}=(0,o.useContext)(I);return o.createElement("div",null,o.createElement("input",T({name:n,value:t[n],onChange:r},e)))}function N({...e}){const{errors:n}=(0,o.useContext)(D);return n?o.createElement("ul",{className:F.Errors},n.map((({message:e},n)=>o.createElement("li",{key:n},e)))):null}function O({...e}){const{busy:n}=(0,o.useContext)(I);return o.createElement("div",null,o.createElement("button",T({type:"submit",name:"action",disabled:n},e)))}let $,_;!function(e){e.Step1="STEP_1",e.Step2="STEP_2",e.Step3="STEP_3"}($||($={})),function(e){e.Init="INIT",e.Next="NEXT",e.Back="BACK",e.Logout="LOGOUT"}(_||(_={}));const j=e=>e.join();var z=t(3827),M={};M.styleTagTransform=x(),M.setAttributes=C(),M.insert=g().bind(null,"head"),M.domAPI=E(),M.insertStyleElement=S(),p()(z.Z,M);const Q=z.Z&&z.Z.locals?z.Z.locals:void 0,R=j`
  query CheckUsername($username: String) {
    checkUsername(username: $username) {
      valid
    }
  }
`,W=j`
  mutation Signin(
    $flow: Flow
    $action: Action
    $step1: LoginStep1Input
    $step2: LoginStep2Input
  ) {
    signin(flow: $flow, action: $action, step1: $step1, step2: $step2) {
      __typename
      flow
      ... on Form {
        view
        errors {
          code
          message
          path
        }
      }
      ... on LoginStep1 {
        username
      }
      ... on LoginStep2 {
        password
      }
    }
  }
`;let Y=null;function J(){const[e]=(0,r.Db)(W),[n,t,{change$:m}]=function(e,n,t){const[r,i]=(0,o.useState)((()=>({form:{},view:null}))),m=(0,o.useMemo)((()=>new l.x),[]);(0,o.useEffect)((()=>{const n=m.pipe((0,s.b)((()=>i((e=>({...e,busy:!0}))))),(0,c.g)(500),(0,u.z)((n=>(0,a.D)(e({variables:n})))),(0,c.g)(500),(0,s.b)((()=>i((e=>({...e,busy:!1})))))).subscribe((e=>Boolean(console.log({mutate:e}))||i((({signin:{flow:e,view:n,errors:t,...o}})=>r=>console.log({data:r,flow:e,view:n,errors:t,form:o})||{...r,flow:e,view:n,errors:t,form:{...r.form,...o}})(e.data))||document.contains(Y)&&Y.focus()));return m.next({}),()=>n.unsubscribe()}),[m]);const d=(0,o.useMemo)((()=>new l.x),[]);(0,o.useEffect)((()=>{const e=d.subscribe((e=>Boolean(console.log({change:e}))||i((n=>({...n,form:{...n.form,...e}})))));return()=>e.unsubscribe()}),[d]);const f=(0,o.useCallback)((e=>(({target:{name:e,value:n}})=>Boolean(console.log(["handleChange"],{name:e,value:n}))||d.next({[e]:n}))(e)),[]),p=(0,o.useCallback)((e=>e.preventDefault()||console.log(Y=document.activeElement)||(({target:e,nativeEvent:{submitter:{value:n}}})=>Boolean(console.log(["handleSubmit"],{action:n}))||e.focus()||m.next(((e,{flow:n,view:t,form:o})=>console.log({action:e,flow:n,view:t,form:o})||Object.assign({flow:n,action:e},{[$.Step1]:{[_.Next]:({username:e})=>({step1:{username:e}})},[$.Step2]:{[_.Back]:()=>({}),[_.Next]:({password:e})=>({step2:{password:e}})},[$.Step3]:{[_.Logout]:()=>({})}}[t][e](o)))(n,r)))(e)),[r]);return[r,()=>({key:r.view,data:r,handleChange:f,handleSubmit:p}),{change$:d,mutate$:m}]}(e),[d]=(0,r.Db)(R),f=(0,o.useMemo)((()=>new l.x),[]);return(0,o.useEffect)((()=>{const e=f.pipe((0,c.g)(500),(0,u.z)((e=>(0,a.D)(d({variables:e})))),(0,c.g)(500)).subscribe((e=>Boolean(console.log({checkUsername$:e}))||m.next({validUsername:e.data.checkUsername.valid})));return()=>e.unsubscribe()}),[f]),(0,o.useEffect)((()=>{const e=m.pipe((0,i.b)(500)).subscribe((e=>Boolean(console.log({change:e}))||e.username&&f.next({username:e.username})));return()=>e.unsubscribe()}),[m]),console.log({data:n}),o.createElement("section",{className:Q.Section},o.createElement("h2",null,"Forms"),n.view&&{[$.Step1]:()=>o.createElement(B,t(),o.createElement(U,null,o.createElement(P,null,"Step1"),o.createElement(L,{name:"username"},o.createElement(G,null,"Username"),o.createElement(Z,{autoFocus:!0}),null!==n.form.validUsername&&o.createElement("div",null,n.form.validUsername?"Valid":"Invalid"),o.createElement(N,null)),o.createElement(O,{value:_.Next},"Next"))),[$.Step2]:()=>o.createElement(B,t(),o.createElement(U,null,o.createElement(P,null,"Step2"),o.createElement(L,{name:"password"},o.createElement(G,null,"Password"),o.createElement(Z,{autoFocus:!0}),o.createElement(N,null)),o.createElement(O,{value:_.Next},"Next"),o.createElement(O,{value:_.Back},"Back"))),[$.Step3]:()=>o.createElement(B,t(),o.createElement(U,null,o.createElement(P,null,"Step3"),o.createElement(O,{value:_.Logout,autoFocus:!0},"Logout")))}[n.view](n.form))}},5450:(e,n,t)=>{t.d(n,{Z:()=>s});var o=t(272),r=t.n(o),l=t(2609),a=t.n(l)()(r());a.push([e.id,".Y0oU17ATPuJ3r9UC_xZg{color:blue}.g4QOpCIIrfx1xI7gat6G.FkcPsz_TwMovCk7Gel3Q fieldset{border-color:red}.DXGw6UCkT0Ljh5PLAFlR.FkcPsz_TwMovCk7Gel3Q{color:red}.O1DkzXeSlWwhWODvimtg{color:red}","",{version:3,sources:["webpack://./src/components/styles.module.scss"],names:[],mappings:"AAAA,sBACE,UAAA,CAIE,oDACE,gBAAA,CAKJ,2CACE,SAAA,CAGJ,sBACE,SAAA",sourcesContent:[".Section {\n  color: blue;\n}\n.Form {\n  &.invalid {\n    fieldset {\n      border-color: red;\n    }\n  }\n}\n.Field {\n  &.invalid {\n    color: red;\n  }\n}\n.Errors {\n  color: red;\n}\n"],sourceRoot:""}]),a.locals={Section:"Y0oU17ATPuJ3r9UC_xZg",Form:"g4QOpCIIrfx1xI7gat6G",invalid:"FkcPsz_TwMovCk7Gel3Q",Field:"DXGw6UCkT0Ljh5PLAFlR",Errors:"O1DkzXeSlWwhWODvimtg"};const s=a},3827:(e,n,t)=>{t.d(n,{Z:()=>s});var o=t(272),r=t.n(o),l=t(2609),a=t.n(l)()(r());a.push([e.id,".HHGfdvALL8opRFX4T2Dp{color:blue}.zmbUS4qY6hyGuScChGns.yjjddBYwRSMIzHy7W6JZ fieldset{border-color:red}.mrN0PYufDWOQtcym4TuQ.yjjddBYwRSMIzHy7W6JZ{color:red}","",{version:3,sources:["webpack://./src/containers/Forms.module.scss"],names:[],mappings:"AAAA,sBACE,UAAA,CAIE,oDACE,gBAAA,CAKJ,2CACE,SAAA",sourcesContent:[".Section {\n  color: blue;\n}\n.Form {\n  &.invalid {\n    fieldset {\n      border-color: red;\n    }\n  }\n}\n.Field {\n  &.invalid {\n    color: red;\n  }\n}\n"],sourceRoot:""}]),a.locals={Section:"HHGfdvALL8opRFX4T2Dp",Form:"zmbUS4qY6hyGuScChGns",invalid:"yjjddBYwRSMIzHy7W6JZ",Field:"mrN0PYufDWOQtcym4TuQ"};const s=a}}]);
//# sourceMappingURL=59.js.map